---
// Header component - Mobile first, full nav at lg (1512px)
const navLinks = [
  { label: "Accueil", href: "/" },
  { label: "Le cabinet", href: "/about" },
  { label: "Contact", href: "/contact" },
  { label: "Articles", href: "/blog" },
];
---

<header class="header flex items-center justify-between py-6 px-(--spacing-container) fixed top-0 left-0 right-0 z-50 bg-(--color-bg-section) shadow-[0_4px_12px_rgba(0,0,0,0.03)] transition-transform duration-300">
  <!-- Logo -->
  <a href="/" class="flex items-center" aria-label="Accueil">
    <img src="/logoMerly.svg" alt="Merly" class="block w-[75px] md:w-[100px] h-auto" width="100" height="30" />
  </a>

  <!-- Navigation - visible at lg, centered -->
  <nav class="hidden lg:flex lg:gap-8 lg:absolute lg:left-1/2 lg:-translate-x-1/2">
    {navLinks.map((link) => (
      <a href={link.href} class="text-(--color-text) no-underline transition-opacity hover:opacity-70">{link.label}</a>
    ))}
  </nav>

  <!-- CTAs - visible at lg -->
  <div class="hidden lg:flex lg:items-center lg:gap-8">
    <a href="/#estimateur" class="text-(--color-text) transition-opacity border-b hover:opacity-70">Estimer mes frais</a>
    <a href="/contact" class="btn-outline !w-auto !py-3">Prendre rendez-vous</a>
  </div>

  <!-- Burger - hidden at lg -->
  <button
    class="burger flex flex-col justify-center gap-[3px] w-[30px] h-[10px] p-0 bg-transparent border-none cursor-pointer focus-visible:outline-2 focus-visible:outline-current focus-visible:outline-offset-4 lg:hidden"
    type="button"
    aria-label="Ouvrir le menu"
    aria-expanded="false"
    aria-controls="mobile-nav"
  >
    <span class="burger-line block w-full h-px bg-current transition-all duration-300"></span>
    <span class="burger-line block w-full h-px bg-current transition-all duration-300"></span>
    <span class="burger-line block w-full h-px bg-current transition-all duration-300"></span>
  </button>
</header>

<!-- Mobile Menu Overlay -->
<div id="mobile-nav" class="mobile-menu fixed top-0 left-0 right-0 h-[40vh] z-40 bg-white lg:hidden" aria-hidden="true">
  <!-- Mobile Menu Header -->
  <div class="flex items-center justify-end py-6 px-(--spacing-container)">
    <button
      class="mobile-menu-close w-11 h-11 flex items-center justify-center bg-transparent border-none cursor-pointer"
      type="button"
      aria-label="Fermer le menu"
    >
      <svg width="21" height="21" viewBox="0 0 21 21" fill="none" stroke="currentColor" stroke-width="1">
        <line x1="0" y1="21" x2="21" y2="0" />
        <line x1="0" y1="0" x2="21" y2="21" />
      </svg>
    </button>
  </div>

  <!-- Mobile Navigation -->
  <nav class="flex flex-col items-end gap-2.5 px-(--spacing-container) mt-8">
    {navLinks.map((link, index) => (
      <a
        href={link.href}
        class="mobile-nav-link text-[36px] font-normal tracking-[-0.36px] leading-[1.36] text-(--color-text) no-underline"
        style={`--delay: ${index * 50}ms`}
      >
        {link.label}
      </a>
    ))}
  </nav>

  <!-- Mobile CTAs -->
  <div class="flex flex-col items-end gap-4 px-(--spacing-container) mt-12">
    <a href="/#estimateur" class="mobile-nav-link text-lg text-(--color-text) border-b border-current" style="--delay: 200ms">
      Estimer mes frais
    </a>
    <a href="/contact" class="mobile-nav-link btn-outline !w-auto mt-2" style="--delay: 250ms">
      Prendre rendez-vous
    </a>
  </div>
</div>

<style>
  /* Header hide on scroll down */
  .header.header-hidden {
    transform: translateY(-100%);
  }

  /* États du burger - nécessite CSS pour aria-expanded */
  .burger[aria-expanded="true"] .burger-line:nth-child(1) {
    transform: translateY(4px) rotate(45deg);
  }
  .burger[aria-expanded="true"] .burger-line:nth-child(2) {
    opacity: 0;
  }
  .burger[aria-expanded="true"] .burger-line:nth-child(3) {
    transform: translateY(-4px) rotate(-45deg);
  }

  /* Mobile menu styles */
  .mobile-menu {
    clip-path: inset(0 0 100% 0);
    transition: clip-path 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
  }

  .mobile-menu[aria-hidden="false"] {
    clip-path: inset(0 0 0 0);
    pointer-events: auto;
  }

  /* Mobile nav links animation */
  .mobile-nav-link {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.4s ease, transform 0.4s ease;
    transition-delay: var(--delay, 0ms);
  }

  .mobile-menu[aria-hidden="false"] .mobile-nav-link {
    opacity: 1;
    transform: translateY(0);
  }

  /* Close button hover */
  .mobile-menu-close {
    transition: transform 0.2s ease;
  }

  .mobile-menu-close:hover {
    transform: rotate(90deg);
  }
</style>

<script>
  const burger = document.querySelector('.burger');
  const header = document.querySelector('.header');
  const mobileMenu = document.getElementById('mobile-nav');
  const closeBtn = document.querySelector('.mobile-menu-close');
  const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');

  function openMenu() {
    mobileMenu?.setAttribute('aria-hidden', 'false');
    burger?.setAttribute('aria-expanded', 'true');
    burger?.setAttribute('aria-label', 'Fermer le menu');
    document.body.style.overflow = 'hidden';
  }

  function closeMenu() {
    mobileMenu?.setAttribute('aria-hidden', 'true');
    burger?.setAttribute('aria-expanded', 'false');
    burger?.setAttribute('aria-label', 'Ouvrir le menu');
    document.body.style.overflow = '';
  }

  burger?.addEventListener('click', () => {
    const isExpanded = burger.getAttribute('aria-expanded') === 'true';
    if (isExpanded) {
      closeMenu();
    } else {
      openMenu();
    }
  });

  closeBtn?.addEventListener('click', closeMenu);

  // Close menu on nav link click
  mobileNavLinks.forEach(link => {
    link.addEventListener('click', closeMenu);
  });

  // Close on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && mobileMenu?.getAttribute('aria-hidden') === 'false') {
      closeMenu();
    }
  });

  // Hide header on scroll down, show on scroll up
  let lastScrollY = window.scrollY;

  window.addEventListener('scroll', () => {
    const currentScrollY = window.scrollY;

    if (currentScrollY > lastScrollY && currentScrollY > 100) {
      // Scrolling down & past threshold
      header?.classList.add('header-hidden');
    } else {
      // Scrolling up
      header?.classList.remove('header-hidden');
    }

    lastScrollY = currentScrollY;
  }, { passive: true });
</script>
